---
import type { InferGetStaticParamsType, GetStaticPaths } from 'astro';
import type { Data } from '@page-configs/example-structure';
import CraftCMSFetch from '@lib/craft-cms/fetch';
import getEntry from '@lib/craft-cms/get-entry';
import {
  cacheDirectory,
  query,
  uriPrefix,
} from '@page-configs/example-structure';
import staticPaths from '@cache/example-structure/static-paths.json';

type Params = InferGetStaticParamsType<typeof getStaticPaths>;

export const getStaticPaths = (async () => {
  return staticPaths;
}) satisfies GetStaticPaths;

const { slug } = Astro.params as Params;

const data = await CraftCMSFetch<Data>({ cacheDirectory, query });

const entries = data?.entries;

if (entries === undefined) {
  return new Response(null, { status: 404 });
}

const entry = await getEntry<Data['entries']>({ entries, slug, uriPrefix });

if (entry === undefined) {
  return new Response(null, { status: 404 });
}
---

{entry.title}
